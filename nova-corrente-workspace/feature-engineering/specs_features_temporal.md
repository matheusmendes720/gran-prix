## Feature Spec – `/features/temporal`

### Vision
Deliver a complete temporal intelligence tab that visualizes seasonal demand drivers, Brazilian calendar events, and cyclical encodings with deterministic demo data while remaining ready for future backend integration.

### User Story
As a Nova Corrente operations lead, I want to understand upcoming time-based events and seasonality patterns so I can adjust procurement schedules, safety stock, and field teams to avoid SLA breaches.

### KPIs
- Time-on-tab ≥ 45s
- Identify at least one actionable event per session
- Highlight forecast accuracy <15% for seasonal windows

### Data Interface
```typescript
type TemporalEvent = {
  id: string
  date: string
  label: string
  impactScore: number // -1 to +1
  demandDelta: number // %
  narrative: string
  recommendedActions: string[]
}

type SeasonalityMatrix = number[][] // 12 months × 7 weekdays normalized 0-1

type CyclicalSample = {
  label: string
  value: number
  sin: number
  cos: number
}

type ForecastSlice = {
  date: string
  actual: number
  predicted: number
  eventId?: string
}

interface TemporalFeaturePayload {
  events: TemporalEvent[]
  seasonalityMatrix: SeasonalityMatrix
  cyclicalSamples: CyclicalSample[]
  forecastSlices: ForecastSlice[]
  summary: {
    nextEvent: TemporalEvent
    confidence: number
    riskLevel: 'low' | 'medium' | 'high'
  }
}
```

### Widget Breakdown
1. **Hero Summary Banner**
   - Inputs: `summary`
   - Output: cards for next event, confidence, risk indicator
   - Interaction: click to scroll to Event Timeline

2. **Event Timeline**
   - Visualization: horizontal timeline with markers for `events`
   - Tooltip: show `narrative`, `demandDelta`, `recommendedActions`
   - Filter: date range picker (already present) filters rendered events

3. **Seasonality Heatmap**
   - Data: `seasonalityMatrix`
   - Actions: hover shows avg demand value and sample narrative snippet
   - CTA: “Ver plano de compras” linking to Action Playbook

4. **Cyclical Encoding Explainer**
   - Chart: line plot of sin/cos for `cyclicalSamples`
   - Callout: text referencing `DataLoader.engineer_features` usage

5. **Forecast Comparison Panel**
   - Combined area/line chart showing `forecastSlices`
   - Event markers referencing `eventId`
   - Stats: MAPE for period, delta vs. historical average

6. **Action Playbook Cards**
   - Generated by grouping `events` in next 30 days
   - Each card lists procurement, operations, finance steps

### Synthetic Data Source Plan
- Start with deterministic array declared in `demoSnapshot.ts`.
- Optional: leverage `DataLoader` to create base demand (120 days) then inject event impacts.
- Provide script snippet for future automation (not implemented yet).

### Storytelling Flow
1. Highlight next major event (Carnaval / rainy season).
2. Show how seasonality heatmap justifies proactive purchases.
3. Illustrate sin/cos encoding (why models understand cyclical patterns).
4. Compare actual vs. forecast around events to prove accuracy.
5. Close with action playbook card — “Compras: aumentar estoque 30% até 10/02”.

### Future Integration Notes
- Replace deterministic payload with API call to `/storytelling/features/temporal`.
- Validate data freshness (timestamp) and event coverage vs. calendar service.
- Hook CTA to create tasks in workflow system (later sprint).

