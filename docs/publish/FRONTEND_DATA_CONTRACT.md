# Frontend Data Contract â€“ Nova Corrente Forecasting

## Overview

This contract describes the datasets exposed by the local batch pipeline for consumption by the frontend application. All artifacts are generated by `demand_forecasting/orchestration/batch_cycle_flow` and stored under `data/outputs/nova_corrente/`.

## Artifacts

| Artifact | Location | Format | Refresh | Notes |
|----------|----------|--------|---------|-------|
| Forecast Series | `data/outputs/nova_corrente/forecasts/item{item_id}_site{site_id}.parquet` | Parquet | Daily | Contains Prophet forecast (`forecast`, `lower`, `upper`), SARIMAX companion (`arima_forecast`), and `xgboost_forecast`. Schema defined in `schema.json`. |
| Prescriptive Summary | `data/outputs/nova_corrente/forecasts/item{item_id}_site{site_id}_prescriptive.json` | JSON | Daily | Output from `PPCalculator`, fields: `reorder_point`, `safety_stock`, `avg_daily_demand`, `lead_time`, `current_stock`, `days_to_rupture`, `stock_status`. |
| Metrics Overview | `data/outputs/nova_corrente/forecasts/metrics.json` | JSON | Daily | Keyed by `item{item_id}_site{site_id}` with `mse` and `mae` for validation window. |

## Access Pattern

1. **Forecast Fetch**: Frontend loads Parquet file and maps to UI charts.
2. **Prescriptive Alerts**: JSON companion provides reorder recommendation displayed alongside forecast.
3. **Quality Badges**: `metrics.json` exposes MSE/MAE for surfacing model confidence indicators.

## Contract Rules

- Dates are ISO strings (`YYYY-MM-DD`).
- Quantities are floats representing daily consumption units.
- `stock_status` is enum: `normal`, `critical`.
- Files are append-only per execution; newer runs overwrite existing Parquet/JSON.
- Consumers must validate against `forecasts/schema.json` before ingestion.

## Evaluation Artifacts

- Rolling cross-validation metrics written per item/site under `logs/pipeline/metrics/rolling_metrics_<key>.parquet`.
- Aggregated summary available at `data/outputs/nova_corrente/forecasts/metrics_summary.json` with references to raw logs.

## Change Management

- Backward-incompatible changes require coordinating with frontend team and versioning via `schema.v2.json`.
- Additive columns follow semantic versioning, with updates recorded in `data/outputs/nova_corrente/CHANGELOG.md` (to be created upon first change).

## Manual Refresh

Run `python scripts/run_batch_cycle.py` from the project root to regenerate all artifacts after ensuring `.env.local` tokens and the GPU environment are active.

