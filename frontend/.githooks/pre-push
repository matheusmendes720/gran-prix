#!/bin/sh
#
# Git pre-push hook for frontend validation
# This script runs before pushing to master/main branch
#

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "${YELLOW}Running pre-push validation...${NC}"

# Change to frontend directory
cd "$(git rev-parse --show-toplevel)/frontend" || exit 1

# Check if we're pushing to master/main
while read local_ref local_sha remote_ref remote_sha
do
  if [ "$remote_ref" = "refs/heads/master" ] || [ "$remote_ref" = "refs/heads/main" ]; then
    echo "${YELLOW}Warning: You are pushing to ${remote_ref}${NC}"
    echo "${YELLOW}Running full validation...${NC}"
    
    # Run full validation
    npm run validate:full
    
    if [ $? -ne 0 ]; then
      echo "${RED}Validation failed! Please fix the issues before pushing.${NC}"
      echo "${YELLOW}To skip validation (not recommended), use: git push --no-verify${NC}"
      exit 1
    fi
    
    echo "${GREEN}Validation passed! Proceeding with push...${NC}"
  else
    echo "${YELLOW}Running quick validation...${NC}"
    
    # Run quick validation for other branches
    npm run validate:quick
    
    if [ $? -ne 0 ]; then
      echo "${RED}Quick validation failed! Please fix the issues before pushing.${NC}"
      echo "${YELLOW}To skip validation (not recommended), use: git push --no-verify${NC}"
      exit 1
    fi
  fi
done

exit 0

